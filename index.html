<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ú® Pink Dreams Blog ‚ú®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cute-pink': '#ffb6c1',
                        'soft-pink': '#ffe4e1',
                        'hot-pink': '#ff69b4',
                        'pastel-pink': '#ffd1dc',
                        'creamy': '#fffafb' // A softer background
                    },
                    fontFamily: {
                        'quicksand': ['Quicksand', 'sans-serif']
                    },
                    boxShadow: {
                        // A custom, soft pink shadow for cards and buttons
                        'cute': '0 6px 16px 0 rgba(255, 105, 180, 0.25)',
                        'cute-hover': '0 8px 20px 0 rgba(255, 105, 180, 0.35)',
                    },
                    keyframes: {
                        pop: {
                            '0%': { transform: 'scale(0.95)', opacity: 0 },
                            '100%': { transform: 'scale(1)', opacity: 1 }
                        }
                    },
                    animation: {
                        pop: 'pop 0.2s ease-out'
                    }
                }
            }
        }
    </script>
   
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap');
        
        /* Hide .admin-only by default */
        .admin-only { display: none; }
        /* Show .admin-only when .logged-in is on the body */
        .logged-in .admin-only { display: block; }

        .kawaii { animation: float 3s ease-in-out infinite; }
        @keyframes float { 
            0%, 100% { transform: translateY(0); } 
            50% { transform: translateY(-8px); } 
        }

        /* Custom focus ring style */
        .pink-focus:focus {
            border-color: #ff69b4; /* hot-pink */
            box-shadow: 0 0 0 2px #ffb6c1; /* cute-pink */
            outline: none;
        }
    </style>
</head>
<body class="bg-creamy font-quicksand text-gray-700 min-h-screen">
    
    <header class="bg-white shadow-md sticky top-0 z-50 border-b border-pink-100">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-extrabold text-hot-pink flex items-center gap-2">
                    <span class="kawaii">üå∏</span>
                    Mary World
                    <span class="kawaii">üíï</span>
                </h1>
                <div class="flex items-center gap-4">
                    <span id="userStatus" class="text-gray-600 font-semibold">üëã Welcome, Guest!</span>
                    <button id="loginBtn" onclick="showLogin()" class="bg-cute-pink text-white px-5 py-2 rounded-full font-semibold shadow-cute hover:shadow-cute-hover hover:bg-hot-pink transform hover:-translate-y-0.5 transition-all">
                        üîê Admin Login
                    </button>
                    <button id="logoutBtn" onclick="logout()" class="bg-hot-pink text-white px-5 py-2 rounded-full font-semibold shadow-cute hover:shadow-cute-hover hover:bg-pink-600 transform hover:-translate-y-0.5 transition-all admin-only" style="display: none;">
                        üëã Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 max-w-3xl">
        
        <div id="adminPanel" class="bg-white rounded-xl shadow-sm p-6 mb-8 border border-pink-100 admin-only" style="display: none;">
            <h2 class="text-2xl font-bold text-cute-pink mb-4 flex items-center gap-2">‚ú® Admin Panel</h2>
            <button onclick="showNewPostForm()" class="bg-cute-pink text-white px-6 py-3 rounded-full font-semibold shadow-cute hover:shadow-cute-hover hover:bg-hot-pink transform hover:-translate-y-0.5 transition-all">
                ‚ûï Write New Post
            </button>
        </div>

        <div id="newPostForm" class="bg-white rounded-xl shadow-sm p-6 mb-8 border border-pink-100" style="display: none;">
            <h3 class="text-xl font-bold text-cute-pink mb-4">üìù Create New Post</h3>
            <input type="text" id="postTitle" placeholder="Post title..." class="w-full p-3 border border-pink-200 rounded-lg mb-4 pink-focus transition-all">
            <textarea id="postContent" placeholder="Write your post here..." rows="6" class="w-full p-3 border border-pink-200 rounded-lg mb-4 pink-focus resize-none transition-all"></textarea>
            <div class="flex gap-3">
                <button onclick="addPost()" class="bg-cute-pink text-white px-6 py-2 rounded-full font-semibold shadow-cute hover:shadow-cute-hover hover:bg-hot-pink transform hover:-translate-y-0.5 transition-all">
                    üíæ Publish
                </button>
                <button onclick="hideNewPostForm()" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-full font-semibold hover:bg-gray-300 transition-all">
                    ‚ùå Cancel
                </button>
            </div>
        </div>

        <div id="postsContainer" class="space-y-8">
            <div class="text-center py-12">
                <div class="text-6xl mb-4">üå∏</div>
                <h2 class="text-3xl font-bold text-hot-pink">No posts yet!</h2>
                <p class="text-gray-500 mt-2">please hold for more mary!‚ú®</p>
            </div>
        </div>
    </main>

    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50 transition-opacity duration-300">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl border border-pink-100 animate-pop">
            <h2 class="text-2xl font-bold text-hot-pink mb-6 text-center">üîê Admin Login</h2>
            <input type="text" id="username" placeholder="Username" class="w-full p-3 border border-pink-200 rounded-lg mb-4 pink-focus transition-all">
            <input type="password" id="password" placeholder="Password" class="w-full p-3 border border-pink-200 rounded-lg mb-6 pink-focus transition-all">
            <div class="flex gap-3">
                <button onclick="login()" class="flex-1 bg-cute-pink text-white py-3 rounded-full font-semibold shadow-cute hover:shadow-cute-hover hover:bg-hot-pink transform hover:-translate-y-0.5 transition-all">
                    ‚ú® Login
                </button>
                <button onclick="hideLogin()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-full font-semibold hover:bg-gray-300 transition-all">
                    Cancel
                </button>
            </div>
            <p class="text-center text-gray-400 text-sm mt-4">Hint: admin / pink123</p>
        </div>
    </div>

 <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // 1. Get these from your Supabase Project Settings > API
    // REPLACE THESE WITH YOUR KEYS!
    const SUPABASE_URL = 'https://phzsxzhkgstfcirzelzo.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBoenN4emhrZ3N0ZmNpcnplbHpvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5NzY1NTksImV4cCI6MjA3ODU1MjU1OX0.EABNIPJrHfhbeyMMYSgdR8-JctHseSISft3pxDr6VQk';

    // 2. Initialize the Supabase client
    // This *must* be defined before anything tries to use it.
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // 3. Grab UI elements (safe to do now)
    const userStatus = document.getElementById('userStatus');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const adminPanel = document.getElementById('adminPanel');
    const postsContainer = document.getElementById('postsContainer');

    /*
    * CORE AUTH: Replaces your old checkLoginStatus()
    * This listener *uses* the 'supabase' variable, so it *must* come after it.
    */
    supabase.auth.onAuthStateChange((event, session) => {
        if (session) {
            // User is logged in
            document.body.classList.add('logged-in');
            userStatus.innerHTML = 'üëë <span class="hidden sm:inline">Logged in as</span> Admin';
            loginBtn.style.display = 'none';
            logoutBtn.style.display = 'block';
            adminPanel.style.display = 'block';
        } else {
            // User is logged out
            document.body.classList.remove('logged-in');
            userStatus.textContent = 'üëã Welcome, Guest!';
            loginBtn.style.display = 'block';
            logoutBtn.style.display = 'none';
            adminPanel.style.display = 'none';
            hideNewPostForm();
        }
        // Always reload posts, so admin buttons appear/disappear
        loadPosts();
    });

    // --- Auth Functions (Rewritten) ---
    // These are defined here, but called by HTML (onclick)
    // They will correctly see the 'supabase' variable from this script's scope.

    function showLogin() {
        const modal = document.getElementById('loginModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.getElementById('username').focus();
    }

    function hideLogin() {
        const modal = document.getElementById('loginModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
    }

    async function login() {
        const email = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        const { data, error } = await supabase.auth.signInWithPassword({
            email: email,
            password: password,
        });

        if (error) {
            alert('‚ùå Invalid login credentials!');
        } else {
            hideLogin();
        }
    }

    async function logout() {
        const { error } = await supabase.auth.signOut();
        if (error) {
            alert('Error logging out:', error.message);
        }
    }

    // --- Post Functions (Rewritten) ---

    function showNewPostForm() {
        document.getElementById('newPostForm').style.display = 'block';
        document.getElementById('postTitle').focus();
    }

    function hideNewPostForm() {
        document.getElementById('newPostForm').style.display = 'none';
        document.getElementById('postTitle').value = '';
        document.getElementById('postContent').value = '';
    }

    async function addPost() {
        const title = document.getElementById('postTitle').value.trim();
        const content = document.getElementById('postContent').value.trim();
        
        if (!title || !content) {
            alert('‚ùå Please fill in both title and content!');
            return;
        }
        
        const { data, error } = await supabase
            .from('posts')
            .insert([ { title: title, content: content } ]);

        if (error) {
            alert('Error adding post: ' + error.message);
        } else {
            hideNewPostForm();
            loadPosts();
        }
    }

    async function deletePost(id) {
        if (confirm('‚ùå Are you sure you want to delete this post?')) {
            const { error } = await supabase
                .from('posts')
                .delete()
                .eq('id', id);

            if (error) {
                alert('Error deleting post: ' + error.message);
            } else {
                loadPosts();
            }
        }
    }

    async function loadPosts() {
        const { data: posts, error } = await supabase
            .from('posts')
            .select('*')
            .order('created_at', { ascending: false });

        if (error) {
            console.error('Error loading posts:', error);
            return;
        }
        
        const { data: { session } } = await supabase.auth.getSession();
        const isLoggedIn = !!session;
        
        if (posts.length === 0) {
            postsContainer.innerHTML = `
                <div class="text-center py-12">
                    <div class="text-6xl mb-4">üå∏</div>
                    <h2 class="text-3xl font-bold text-hot-pink">No posts yet!</h2>
                    <p class="text-gray-500 mt-2">${isLoggedIn ? 'Create your first dreamy post above! ‚ú®' : 'please hold for more mary!'}</p>
                </div>
            `;
            return;
        }
        
        postsContainer.innerHTML = posts.map(post => {
            const postDate = new Date(post.created_at).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            return `
            <article class="post-card bg-white rounded-xl shadow-cute p-6 md:p-8 relative transition-all duration-300 hover:shadow-cute-hover hover:-translate-y-1">
                ${isLoggedIn ? `
                    <div class="absolute top-4 right-4 flex gap-2">
                        <button onclick="deletePost(${post.id})" class="bg-gray-200 text-gray-500 w-9 h-9 rounded-full hover:bg-red-500 hover:text-white transition-all flex items-center justify-center" title="Delete post">
                            <span>üóëÔ∏è</span>
                        </button>
                    </div>
                ` : ''}
                <div class="flex items-center gap-2 text-gray-400 text-sm font-semibold mb-2">
                    <span>üìÖ</span>
                    <time>${postDate}</time>
                </div>
                <h2 class="text-3xl font-bold text-gray-900 mb-4">${post.title}</h2>
                <div class="text-gray-700 text-lg leading-relaxed whitespace-pre-wrap">${post.content}</div>
                <div class="mt-6 pt-4 border-t border-pink-100 flex items-center gap-2 text-pink-300 text-sm">
                    <span>üíï</span>
                    <span>Thanks for reading!</span>
                </div>
            </article>
            `
        }).join('');
    }

    // Handle Enter key in login form
    document.getElementById('password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') login();
    });
    document.getElementById('username').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') login();
    });

    // Load posts on initial page load
    loadPosts();
</script>
</body>
</html>
